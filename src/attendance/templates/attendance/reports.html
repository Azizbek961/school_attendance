{% extends 'attendance/base_admin.html' %}

{% block title %}Hisobotlar - SAMO School{% endblock %}
{% block page_title %}Hisobotlar{% endblock %}
{% block page_subtitle %}Davomat hisobotlarini generatsiya qilish va yuklab olish{% endblock %}

{% block content %}
<div class="dashboard-card">
    <div class="card-header">
        <h3>Hisobot Generatsiya Qilish</h3>
        <div class="card-header-actions">
            <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#helpModal">
                <i class="fas fa-question-circle"></i> Yordam
            </button>
        </div>
    </div>

    <div class="card-body">
        <!-- Hisobot turini tanlash -->
        <div class="row mb-5">
            <div class="col-12">
                <h4 class="section-title">Hisobot Turini Tanlang</h4>
                <div class="report-type-selector">
                    <div class="row g-4">
                        <div class="col-md-3">
                            <div class="report-type-card" data-type="daily" onclick="selectReportType('daily')">
                                <div class="report-icon">
                                    <i class="fas fa-calendar-day"></i>
                                </div>
                                <h5>Kunlik Hisobot</h5>
                                <p>Bir kunlik davomat hisoboti</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="report-type-card" data-type="weekly" onclick="selectReportType('weekly')">
                                <div class="report-icon">
                                    <i class="fas fa-calendar-week"></i>
                                </div>
                                <h5>Haftalik Hisobot</h5>
                                <p>Bir haftalik davomat hisoboti</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="report-type-card" data-type="monthly" onclick="selectReportType('monthly')">
                                <div class="report-icon">
                                    <i class="fas fa-calendar-alt"></i>
                                </div>
                                <h5>Oylik Hisobot</h5>
                                <p>Bir oylik davomat hisoboti</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="report-type-card" data-type="custom" onclick="selectReportType('custom')">
                                <div class="report-icon">
                                    <i class="fas fa-calendar"></i>
                                </div>
                                <h5>Maxsus Hisobot</h5>
                                <p>Tanlangan oralikdagi hisobot</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Hisobot parametrlari formasi -->
        <div class="report-params-section" id="reportParamsSection" style="display: none;">
            <h4 class="section-title">Hisobot Parametrlari</h4>
            <form method="post" action="{% url 'generate_report' %}" id="reportForm" class="needs-validation" novalidate>
                {% csrf_token %}
                
                <!-- Hisobot turi -->
                <input type="hidden" id="report_type" name="report_type" value="">

                <!-- Sana oralig'i -->
                <div class="row g-4 mb-4">
                    <div class="col-md-6">
                        <label for="start_date" class="form-label">Boshlanish Sanasi *</label>
                        <input type="date" class="form-control" id="start_date" name="start_date" required>
                    </div>
                    <div class="col-md-6">
                        <label for="end_date" class="form-label">Tugash Sanasi *</label>
                        <input type="date" class="form-control" id="end_date" name="end_date" required>
                    </div>
                </div>

                <!-- Filtrlar -->
                <div class="row g-4 mb-4">
                    <div class="col-md-4">
                        <label for="class_filter" class="form-label">Sinf</label>
                        <select class="form-control" id="class_filter" name="class">
                            <option value="">Barcha sinflar</option>
                            {% for class in classes %}
                            <option value="{{ class.id }}">{{ class.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label for="subject_filter" class="form-label">Fan</label>
                        <select class="form-control" id="subject_filter" name="subject">
                            <option value="">Barcha fanlar</option>
                            {% for subject in subjects %}
                            <option value="{{ subject.id }}">{{ subject.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label for="status_filter" class="form-label">Davomat Holati</label>
                        <select class="form-control" id="status_filter" name="status">
                            <option value="">Barcha holatlar</option>
                            <option value="present">Bor</option>
                            <option value="absent">Yo'q</option>
                            <option value="late">Kechikdi</option>
                            <option value="excused">Sababli</option>
                        </select>
                    </div>
                </div>

                <!-- Hisobot formati -->
                <div class="row g-4 mb-4">
                    <div class="col-12">
                        <h5 class="mb-3">Eksport Formati</h5>
                        <div class="format-selector">
                            <div class="row g-3">
                                <div class="col-md-3">
                                    <div class="format-option">
                                        <input type="radio" class="btn-check" name="export_format" id="format_csv" value="csv" checked>
                                        <label class="btn btn-outline-secondary w-100" for="format_csv">
                                            <i class="fas fa-file-csv"></i>
                                            <span>CSV</span>
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="format-option">
                                        <input type="radio" class="btn-check" name="export_format" id="format_excel" value="excel">
                                        <label class="btn btn-outline-secondary w-100" for="format_excel">
                                            <i class="fas fa-file-excel"></i>
                                            <span>Excel</span>
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="format-option">
                                        <input type="radio" class="btn-check" name="export_format" id="format_pdf" value="pdf">
                                        <label class="btn btn-outline-secondary w-100" for="format_pdf">
                                            <i class="fas fa-file-pdf"></i>
                                            <span>PDF</span>
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="format-option">
                                        <input type="radio" class="btn-check" name="export_format" id="format_print" value="print">
                                        <label class="btn btn-outline-secondary w-100" for="format_print">
                                            <i class="fas fa-print"></i>
                                            <span>Chop etish</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Qo'shimcha parametrlar -->
                <div class="row g-4 mb-4">
                    <div class="col-12">
                        <h5 class="mb-3">Qo'shimcha Sozlamalar</h5>
                        <div class="additional-settings">
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="include_student_details" name="include_student_details" checked>
                                <label class="form-check-label" for="include_student_details">
                                    O'quvchi ma'lumotlarini qo'shish (telefon, email)
                                </label>
                            </div>
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="include_teacher_details" name="include_teacher_details">
                                <label class="form-check-label" for="include_teacher_details">
                                    O'qituvchi ma'lumotlarini qo'shish
                                </label>
                            </div>
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="include_summary" name="include_summary" checked>
                                <label class="form-check-label" for="include_summary">
                                    Umumiy statistika qo'shish
                                </label>
                            </div>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="group_by_class" name="group_by_class" checked>
                                <label class="form-check-label" for="group_by_class">
                                    Sinflar bo'yicha guruhlash
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Oldindan ko'rish va generatsiya qilish -->
                <div class="row g-4">
                    <div class="col-12">
                        <div class="d-flex justify-content-between">
                            <button type="button" class="btn btn-outline-primary" id="previewBtn" onclick="previewReport()">
                                <i class="fas fa-eye"></i> Oldindan Ko'rish
                            </button>
                            <div>
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="fas fa-download"></i> Hisobotni Yuklab Olish
                                </button>
                                <button type="button" class="btn btn-secondary btn-lg" onclick="resetReportForm()">
                                    <i class="fas fa-redo"></i> Tozalash
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <!-- Oldindan ko'rish bo'limi -->
        <div class="preview-section mt-5" id="previewSection" style="display: none;">
            <h4 class="section-title">Hisobot Oldindan Ko'rinishi</h4>
            <div class="preview-container" id="previewContainer">
                <!-- Oldindan ko'rish ma'lumotlari bu yerda yuklanadi -->
            </div>
        </div>

        <!-- So'nggi hisobotlar -->
        <div class="recent-reports mt-5">
            <h4 class="section-title">So'nggi Generatsiya Qilingan Hisobotlar</h4>
            <div class="table-responsive">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Hisobot Nomi</th>
                            <th>Sana oralig'i</th>
                            <th>Format</th>
                            <th>Hajmi</th>
                            <th>Generatsiya qilingan</th>
                            <th>Amallar</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Bu yerda serverdan so'nggi hisobotlar ro'yxati yuklanadi -->
                        <tr>
                            <td colspan="6" class="text-center py-4">
                                <div class="empty-state">
                                    <i class="fas fa-file-alt fa-3x mb-3"></i>
                                    <h4>Hech qanday hisobot topilmadi</h4>
                                    <p>Hisobot generatsiya qilish uchun yuqoridagi formani to'ldiring</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Yordam modal oynasi -->
<div class="modal fade" id="helpModal" tabindex="-1" aria-labelledby="helpModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="helpModalLabel">Hisobot Generatsiya Qilish Yo'riqnomasi</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="accordion" id="helpAccordion">
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingOne">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                Hisobot turlari
                            </button>
                        </h2>
                        <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#helpAccordion">
                            <div class="accordion-body">
                                <ul>
                                    <li><strong>Kunlik hisobot:</strong> Tanlangan bir kun uchun davomat hisoboti</li>
                                    <li><strong>Haftalik hisobot:</strong> Tanlangan hafta uchun davomat hisoboti</li>
                                    <li><strong>Oylik hisobot:</strong> Tanlangan oy uchun davomat hisoboti</li>
                                    <li><strong>Maxsus hisobot:</strong> Tanlangan istalgan sana oralig'i uchun hisobot</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingTwo">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                Eksport formatlari
                            </button>
                        </h2>
                        <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#helpAccordion">
                            <div class="accordion-body">
                                <ul>
                                    <li><strong>CSV:</strong> Microsoft Excel va boshqa spreadsheet dasturlarida ochish mumkin</li>
                                    <li><strong>Excel:</strong> .xlsx formatida to'liq formatlangan fayl</li>
                                    <li><strong>PDF:</strong> Chop etish va yuborish uchun qulay format</li>
                                    <li><strong>Chop etish:</strong> To'g'ridan-to'g'ri printerga yuborish</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingThree">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                Filtrlash imkoniyatlari
                            </button>
                        </h2>
                        <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#helpAccordion">
                            <div class="accordion-body">
                                <ul>
                                    <li><strong>Sinf bo'yicha filtrlash:</strong> Ma'lum bir sinf uchun hisobot</li>
                                    <li><strong>Fan bo'yicha filtrlash:</strong> Ma'lum bir fan uchun hisobot</li>
                                    <li><strong>Davomat holati bo'yicha filtrlash:</strong> Faqat ma'lum holatdagi yozuvlar</li>
                                    <li><strong>Qo'shimcha ma'lumotlar:</strong> O'quvchi va o'qituvchi ma'lumotlarini qo'shish</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Tushunarli</button>
            </div>
        </div>
    </div>
</div>

<!-- Oldindan ko'rish modal oynasi -->
<div class="modal fade" id="previewModal" tabindex="-1" aria-labelledby="previewModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="previewModalLabel">Hisobot Oldindan Ko'rinishi</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="previewModalContent">
                <!-- Oldindan ko'rish ma'lumotlari bu yerda yuklanadi -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Yopish</button>
                <button type="button" class="btn btn-primary" onclick="downloadReport()">
                    <i class="fas fa-download"></i> Yuklab Olish
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Hisobot turini tanlash
function selectReportType(type) {
    // Barcha kartalardan active class ni olib tashlash
    document.querySelectorAll('.report-type-card').forEach(card => {
        card.classList.remove('active');
    });
    
    // Tanlangan kartaga active class qo'shish
    const selectedCard = document.querySelector(`.report-type-card[data-type="${type}"]`);
    if (selectedCard) {
        selectedCard.classList.add('active');
    }
    
    // Hisobot turini formaga yozish
    document.getElementById('report_type').value = type;
    
    // Sana maydonlarini o'rnatish
    const today = new Date();
    const startDateInput = document.getElementById('start_date');
    const endDateInput = document.getElementById('end_date');
    
    switch(type) {
        case 'daily':
            startDateInput.value = today.toISOString().split('T')[0];
            endDateInput.value = today.toISOString().split('T')[0];
            break;
        case 'weekly':
            const weekAgo = new Date(today);
            weekAgo.setDate(today.getDate() - 7);
            startDateInput.value = weekAgo.toISOString().split('T')[0];
            endDateInput.value = today.toISOString().split('T')[0];
            break;
        case 'monthly':
            const monthAgo = new Date(today);
            monthAgo.setMonth(today.getMonth() - 1);
            startDateInput.value = monthAgo.toISOString().split('T')[0];
            endDateInput.value = today.toISOString().split('T')[0];
            break;
        case 'custom':
            // Foydalanuvchi o'zi kiritadi
            startDateInput.value = '';
            endDateInput.value = '';
            break;
    }
    
    // Parametrlar bo'limini ko'rsatish
    document.getElementById('reportParamsSection').style.display = 'block';
    
    // Oldindan ko'rish bo'limini yashirish
    document.getElementById('previewSection').style.display = 'none';
    
    // Formani tekshirish
    validateReportForm();
}

// Formani tekshirish
function validateReportForm() {
    const form = document.getElementById('reportForm');
    const startDate = document.getElementById('start_date').value;
    const endDate = document.getElementById('end_date').value;
    
    if (startDate && endDate) {
        const start = new Date(startDate);
        const end = new Date(endDate);
        
        if (start > end) {
            alert('Boshlanish sanasi tugash sanasidan keyin bo\'lishi mumkin emas!');
            return false;
        }
    }
    
    return true;
}

// Oldindan ko'rish
function previewReport() {
    if (!validateReportForm()) return;
    
    // Loading holatini ko'rsatish
    const previewContainer = document.getElementById('previewContainer');
    previewContainer.innerHTML = `
        <div class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Yuklanmoqda...</span>
            </div>
            <p class="mt-2">Hisobot tayyorlanmoqda...</p>
        </div>
    `;
    
    // AJAX orqali oldindan ko'rish ma'lumotlarini yuklash
    const formData = new FormData(document.getElementById('reportForm'));
    
    fetch('/reports/preview/', {
        method: 'POST',
        body: formData,
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
        }
    })
    .then(response => {
        if (!response.ok) throw new Error('Server error');
        return response.json();
    })
    .then(data => {
        displayPreview(data);
    })
    .catch(error => {
        console.error('Error:', error);
        previewContainer.innerHTML = `
            <div class="alert alert-danger">
                <i class="fas fa-exclamation-triangle"></i>
                Oldindan ko'rish yuklanmadi. Iltimos, qayta urinib ko'ring.
            </div>
        `;
    });
    
    // Oldindan ko'rish bo'limini ko'rsatish
    document.getElementById('previewSection').style.display = 'block';
}

// Oldindan ko'rish ma'lumotlarini ko'rsatish
function displayPreview(data) {
    const previewContainer = document.getElementById('previewContainer');
    
    let html = `
        <div class="preview-card">
            <div class="preview-header">
                <h5>Davomat Hisoboti</h5>
                <div class="preview-meta">
                    <span><i class="far fa-calendar"></i> ${data.date_range || ''}</span>
                    <span><i class="fas fa-users"></i> ${data.total_records || 0} ta yozuv</span>
                </div>
            </div>
            <div class="preview-body">
    `;
    
    if (data.summary) {
        html += `
            <div class="preview-summary">
                <h6>Umumiy Statistika</h6>
                <div class="row">
                    <div class="col-md-3">
                        <div class="stat-item">
                            <span class="stat-label">Borlar:</span>
                            <span class="stat-value text-success">${data.summary.present || 0}</span>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-item">
                            <span class="stat-label">Yo'qlar:</span>
                            <span class="stat-value text-danger">${data.summary.absent || 0}</span>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-item">
                            <span class="stat-label">Kechikkanlar:</span>
                            <span class="stat-value text-warning">${data.summary.late || 0}</span>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-item">
                            <span class="stat-label">Davomat foizi:</span>
                            <span class="stat-value text-primary">${data.summary.attendance_percentage || 0}%</span>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }
    
    if (data.records && data.records.length > 0) {
        html += `
            <div class="preview-table mt-4">
                <h6>Davomat Yozuvlari (namuna)</h6>
                <div class="table-responsive">
                    <table class="table table-sm table-striped">
                        <thead>
                            <tr>
                                <th>O'quvchi</th>
                                <th>Sinf</th>
                                <th>Fan</th>
                                <th>Sana</th>
                                <th>Holat</th>
                            </tr>
                        </thead>
                        <tbody>
        `;
        
        // Faqat birinchi 10 ta yozuvni ko'rsatish
        data.records.slice(0, 10).forEach(record => {
            html += `
                <tr>
                    <td>${record.student_name}</td>
                    <td>${record.class_name}</td>
                    <td>${record.subject_name}</td>
                    <td>${record.date}</td>
                    <td>
                        ${record.status === 'present' ? '<span class="badge bg-success">Bor</span>' : ''}
                        ${record.status === 'absent' ? '<span class="badge bg-danger">Yo\'q</span>' : ''}
                        ${record.status === 'late' ? '<span class="badge bg-warning">Kechikdi</span>' : ''}
                        ${record.status === 'excused' ? '<span class="badge bg-info">Sababli</span>' : ''}
                    </td>
                </tr>
            `;
        });
        
        html += `
                        </tbody>
                    </table>
                </div>
                ${data.records.length > 10 ? 
                    `<p class="text-muted mt-2">+ yana ${data.records.length - 10} ta yozuv...</p>` : 
                    ''
                }
            </div>
        `;
    } else {
        html += `
            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i>
                Tanlangan filterlar bo'yicha davomat yozuvlari topilmadi.
            </div>
        `;
    }
    
    html += `
            </div>
            <div class="preview-footer">
                <small class="text-muted">Hisobot ${new Date().toLocaleString()} da generatsiya qilindi</small>
            </div>
        </div>
    `;
    
    previewContainer.innerHTML = html;
}

// Formani tozalash
function resetReportForm() {
    if (confirm('Barcha tanlovlarni tozalashni tasdiqlaysizmi?')) {
        document.getElementById('reportForm').reset();
        document.getElementById('report_type').value = '';
        document.querySelectorAll('.report-type-card').forEach(card => {
            card.classList.remove('active');
        });
        document.getElementById('reportParamsSection').style.display = 'none';
        document.getElementById('previewSection').style.display = 'none';
    }
}

// Hisobotni yuklab olish
function downloadReport() {
    document.getElementById('reportForm').submit();
}

// Format tanlovlarini faollashtirish
document.addEventListener('DOMContentLoaded', function() {
    // Format tanlovlariga visual effekt
    document.querySelectorAll('.format-option input[type="radio"]').forEach(radio => {
        radio.addEventListener('change', function() {
            document.querySelectorAll('.format-option label').forEach(label => {
                label.classList.remove('active');
            });
            
            const selectedLabel = document.querySelector(`label[for="${this.id}"]`);
            if (selectedLabel) {
                selectedLabel.classList.add('active');
            }
        });
        
        if (radio.checked) {
            const selectedLabel = document.querySelector(`label[for="${radio.id}"]`);
            if (selectedLabel) {
                selectedLabel.classList.add('active');
            }
        }
    });
    
    // Tugmani bosganda formani yuborish
    document.getElementById('reportForm').addEventListener('submit', function(e) {
        if (!validateReportForm()) {
            e.preventDefault();
            return false;
        }
        
        // Yuklash holatini ko'rsatish
        const submitBtn = this.querySelector('button[type="submit"]');
        if (submitBtn) {
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Tayyorlanmoqda...';
            submitBtn.disabled = true;
        }
    });
    
    // Boshlanish sanasi o'zgarganda tugash sanasini tekshirish
    document.getElementById('start_date').addEventListener('change', function() {
        const endDate = document.getElementById('end_date');
        if (this.value && endDate.value) {
            if (new Date(this.value) > new Date(endDate.value)) {
                endDate.value = this.value;
            }
        }
    });
});
</script>

<style>
/* Custom styles for reports.html */
.section-title {
    font-size: 1.2rem;
    color: #2c3e50;
    border-bottom: 2px solid #3498db;
    padding-bottom: 0.5rem;
    margin-bottom: 1.5rem;
}

.report-type-selector {
    margin-bottom: 30px;
}

.report-type-card {
    background: white;
    border: 2px solid #dee2e6;
    border-radius: 10px;
    padding: 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

.report-type-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    border-color: #3498db;
}

.report-type-card.active {
    border-color: #3498db;
    background: #e8f4fd;
    transform: translateY(-5px);
    box-shadow: 0 5px 15px rgba(52, 152, 219, 0.2);
}

.report-icon {
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 24px;
    margin-bottom: 15px;
}

.report-type-card h5 {
    color: #2c3e50;
    margin-bottom: 10px;
    font-size: 16px;
}

.report-type-card p {
    color: #7f8c8d;
    font-size: 14px;
    margin: 0;
}

.report-params-section {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 25px;
    margin-bottom: 30px;
}

.format-selector {
    margin-top: 10px;
}

.format-option label {
    padding: 15px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100%;
    transition: all 0.3s ease;
}

.format-option label i {
    font-size: 24px;
    margin-bottom: 8px;
}

.format-option label span {
    font-weight: 600;
    font-size: 14px;
}

.format-option label.active {
    background: #3498db;
    color: white;
    border-color: #3498db;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.additional-settings {
    background: white;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    padding: 20px;
}

.preview-section {
    animation: fadeIn 0.5s ease;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.preview-card {
    background: white;
    border: 1px solid #dee2e6;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.preview-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 20px;
}

.preview-header h5 {
    margin: 0;
    font-size: 1.5rem;
}

.preview-meta {
    display: flex;
    gap: 20px;
    margin-top: 10px;
    font-size: 14px;
    opacity: 0.9;
}

.preview-meta i {
    margin-right: 5px;
}

.preview-body {
    padding: 20px;
}

.preview-summary {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 20px;
}

.preview-summary h6 {
    color: #2c3e50;
    margin-bottom: 15px;
    font-size: 1rem;
}

.stat-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px;
    background: white;
    border-radius: 6px;
    border: 1px solid #dee2e6;
}

.stat-label {
    font-weight: 500;
    color: #2c3e50;
}

.stat-value {
    font-weight: 700;
    font-size: 18px;
}

.preview-table {
    margin-top: 20px;
}

.preview-table h6 {
    color: #2c3e50;
    margin-bottom: 15px;
    font-size: 1rem;
}

.preview-footer {
    padding: 15px 20px;
    background: #f8f9fa;
    border-top: 1px solid #dee2e6;
    text-align: center;
}

.recent-reports {
    margin-top: 40px;
}

.empty-state {
    text-align: center;
    padding: 20px;
}

.empty-state i {
    color: #bdc3c7;
}

.empty-state h4 {
    color: #7f8c8d;
    margin: 10px 0;
}

.empty-state p {
    color: #95a5a6;
    margin: 0;
}

/* Form validation */
.was-validated .form-control:invalid {
    border-color: #e74c3c;
}

.was-validated .form-control:valid {
    border-color: #2ecc71;
}

/* Loading animation */
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.fa-spinner {
    animation: spin 1s linear infinite;
}

/* Responsive */
@media (max-width: 768px) {
    .report-type-card {
        padding: 15px;
    }
    
    .report-icon {
        width: 50px;
        height: 50px;
        font-size: 20px;
    }
    
    .format-option label {
        padding: 10px;
    }
    
    .format-option label i {
        font-size: 20px;
        margin-bottom: 5px;
    }
    
    .preview-meta {
        flex-direction: column;
        gap: 5px;
    }
}
</style>
{% endblock %}